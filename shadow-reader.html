<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智能影子跟读书籍播放器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            accent: '#F59E0B',
            dark: '#1E293B',
            light: '#F8FAFC'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .backdrop-blur {
        backdrop-filter: blur(8px);
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .animate-pulse-slow {
        animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
    }
  </style>
</head>

<body class="font-inter bg-gray-50 text-dark min-h-screen flex flex-col">
  <!-- 播放器容器 -->
  <div class="max-w-5xl w-full mx-auto bg-white rounded-xl shadow-lg overflow-hidden my-4 transition-all duration-300">
    <!-- 视频区域 -->
    <div class="relative bg-black aspect-video">
      <video id="main-video" class="w-full h-full object-contain" poster="https://picsum.photos/1280/720">
        <source src="https://www.youtube.com/watch?v=3T7Ekt9sPYU" type="video/mp4">
        您的浏览器不支持HTML5视频播放
      </video>
      
      <!-- 视频控制覆盖层 -->
      <div id="video-controls" class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4">
        <!-- 进度条 -->
        <div class="relative h-1 bg-gray-600 rounded-full mb-4 cursor-pointer group" id="progress-container">
          <div id="progress-bar" class="absolute top-0 left-0 h-full bg-primary rounded-full w-1/3"></div>
          <div class="absolute top-1/2 left-1/3 -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
        </div>
        
        <!-- 控制按钮组 -->
        <div class="flex items-center justify-between text-white">
          <div class="flex items-center gap-4">
            <button id="play-pause" class="hover:text-primary transition-colors">
              <i class="fa fa-play text-xl"></i>
            </button>
            
            <div class="flex items-center gap-2">
              <button id="prev-sentence" class="hover:text-primary transition-colors">
                <i class="fa fa-step-backward"></i>
              </button>
              <button id="next-sentence" class="hover:text-primary transition-colors">
                <i class="fa fa-step-forward"></i>
              </button>
            </div>
            
            <div class="hidden md:flex items-center gap-2">
              <span id="current-time" class="text-sm">01:23</span>
              <span class="text-sm">/</span>
              <span id="total-time" class="text-sm">10:45</span>
            </div>
          </div>
          
          <div class="flex items-center gap-4">
            <!-- 倍速控制 -->
            <div class="relative group">
              <button class="hover:text-primary transition-colors flex items-center gap-1">
                <i class="fa fa-tachometer"></i>
                <span id="speed-display" class="text-sm">1.0x</span>
              </button>
              <div class="absolute bottom-full right-0 mb-2 bg-dark/90 backdrop-blur rounded-lg shadow-xl p-2 hidden group-hover:block w-24 z-10">
                <div class="flex flex-col gap-1">
                  <button class="speed-option text-left px-2 py-1 rounded hover:bg-primary/20 text-sm" data-speed="0.5">0.5x</button>
                  <button class="speed-option text-left px-2 py-1 rounded hover:bg-primary/20 text-sm" data-speed="0.75">0.75x</button>
                  <button class="speed-option text-left px-2 py-1 rounded bg-primary/20 text-sm" data-speed="1.0">1.0x</button>
                  <button class="speed-option text-left px-2 py-1 rounded hover:bg-primary/20 text-sm" data-speed="1.25">1.25x</button>
                  <button class="speed-option text-left px-2 py-1 rounded hover:bg-primary/20 text-sm" data-speed="1.5">1.5x</button>
                  <button class="speed-option text-left px-2 py-1 rounded hover:bg-primary/20 text-sm" data-speed="2.0">2.0x</button>
                </div>
              </div>
            </div>
            
            <!-- 字幕控制 -->
            <div class="relative group">
              <button class="hover:text-primary transition-colors flex items-center gap-1">
                <i class="fa fa-closed-captioning-o"></i>
                <span id="subtitle-display" class="text-sm hidden md:inline">中</span>
              </button>
              <div class="absolute bottom-full right-0 mb-2 bg-dark/90 backdrop-blur rounded-lg shadow-xl p-2 hidden group-hover:block w-24 z-10">
                <div class="flex flex-col gap-1">
                  <button class="subtitle-option text-left px-2 py-1 rounded bg-primary/20 text-sm" data-subtitle="zh">中文</button>
                  <button class="subtitle-option text-left px-2 py-1 rounded hover:bg-primary/20 text-sm" data-subtitle="en">英文</button>
                  <button class="subtitle-option text-left px-2 py-1 rounded hover:bg-primary/20 text-sm" data-subtitle="both">双语</button>
                  <button class="subtitle-option text-left px-2 py-1 rounded hover:bg-primary/20 text-sm" data-subtitle="off">关闭</button>
                </div>
              </div>
            </div>
            
            <!-- 循环控制 -->
            <button id="loop-toggle" class="hover:text-primary transition-colors">
              <i class="fa fa-repeat"></i>
            </button>
            
            <!-- 音量控制 -->
            <div class="hidden md:flex items-center gap-2">
              <button id="mute-toggle" class="hover:text-primary transition-colors">
                <i class="fa fa-volume-up"></i>
              </button>
              <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="1" class="w-16 accent-primary">
            </div>
            
            <!-- 全屏控制 -->
            <button id="fullscreen-toggle" class="hover:text-primary transition-colors">
              <i class="fa fa-expand"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- 字幕显示区 -->
      <div id="subtitle-container" class="absolute bottom-20 left-0 right-0 px-4 text-center">
        <div id="zh-subtitle" class="text-white text-shadow text-lg md:text-xl mb-1 bg-black/40 px-4 py-2 rounded-lg">这是一句中文字幕</div>
        <div id="en-subtitle" class="text-white text-shadow text-base md:text-lg bg-black/40 px-4 py-2 rounded-lg hidden">This is an English subtitle</div>
      </div>
      
      <!-- 录音状态指示器 -->
      <div id="recording-indicator" class="absolute top-4 right-4 bg-red-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1 hidden">
        <span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>
        正在录音
      </div>
    </div>
    
    <!-- 主要功能区 -->
    <div class="p-4">
      <div class="flex flex-col lg:flex-row gap-6">
        <!-- 左侧：字幕和跟读区 -->
        <div class="lg:w-2/3 space-y-4">
          <!-- 录音控制 -->
          <div class="bg-gray-50 rounded-lg p-4 shadow-sm">
            <h3 class="text-lg font-semibold mb-3 flex items-center">
              <i class="fa fa-microphone text-primary mr-2"></i>
              影子跟读练习
            </h3>
            
            <div class="flex flex-wrap gap-3 items-center">
              <button id="record-btn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                <i class="fa fa-microphone"></i>
                <span>开始录音</span>
              </button>
              
              <button id="stop-record-btn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5 hidden">
                <i class="fa fa-stop"></i>
                <span>停止录音</span>
              </button>
              
              <button id="play-record-btn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5 hidden">
                <i class="fa fa-play"></i>
                <span>播放录音</span>
              </button>
              
              <button id="compare-btn" class="bg-accent hover:bg-accent/90 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5 hidden">
                <i class="fa fa-bar-chart"></i>
                <span>AI 评分</span>
              </button>
            </div>
            
            <!-- 评分结果 -->
            <div id="score-result" class="mt-4 hidden">
              <div class="flex items-center gap-3 mb-2">
                <div class="text-2xl font-bold text-primary">85</div>
                <div class="text-sm text-gray-600">发音评分</div>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div class="bg-primary h-2.5 rounded-full" style="width: 85%"></div>
              </div>
              <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2 text-sm">
                <div class="bg-gray-100 p-2 rounded">
                  <div class="font-medium">流利度</div>
                  <div class="text-green-600">90/100</div>
                </div>
                <div class="bg-gray-100 p-2 rounded">
                  <div class="font-medium">准确度</div>
                  <div class="text-yellow-600">82/100</div>
                </div>
                <div class="bg-gray-100 p-2 rounded">
                  <div class="font-medium">重音</div>
                  <div class="text-primary">88/100</div>
                </div>
              </div>
              <div class="mt-3 text-sm text-gray-700">
                <p><span class="font-medium">建议：</span>注意单词 "pronunciation" 的重音位置，以及 "the" 在元音前的发音。</p>
              </div>
            </div>
          </div>
          
          <!-- 逐句字幕和听写 -->
          <div class="bg-gray-50 rounded-lg p-4 shadow-sm">
            <div class="flex justify-between items-center mb-3">
              <h3 class="text-lg font-semibold flex items-center">
                <i class="fa fa-file-text-o text-primary mr-2"></i>
                逐句学习
              </h3>
              <div class="flex gap-2">
                <button id="dictation-mode" class="text-sm bg-accent/10 hover:bg-accent/20 text-accent px-3 py-1 rounded transition-colors">
                  听写模式
                </button>
              </div>
            </div>
            
            <!-- 句子列表 -->
            <div id="sentences-container" class="max-h-64 overflow-y-auto scrollbar-hide space-y-2 text-sm">
              <div class="p-3 bg-primary/10 border-l-4 border-primary rounded-r cursor-pointer hover:bg-primary/20 transition-colors">
                <div class="flex justify-between">
                  <div class="zh-sentence">这是第一句中文台词</div>
                  <button class="text-gray-500 hover:text-primary text-xs"><i class="fa fa-volume-up"></i></button>
                </div>
                <div class="en-sentence text-gray-700 mt-1">This is the first English line</div>
              </div>
              
              <div class="p-3 bg-white border-l-4 border-gray-300 rounded-r cursor-pointer hover:bg-gray-50 transition-colors">
                <div class="flex justify-between">
                  <div class="zh-sentence">这是第二句中文台词，包含一个<span class="text-red-500 cursor-pointer hover:underline" data-word="difficult">难</span>的单词</div>
                  <button class="text-gray-500 hover:text-primary text-xs"><i class="fa fa-volume-up"></i></button>
                </div>
                <div class="en-sentence text-gray-700 mt-1">This is the second English line with a <span class="text-red-500 cursor-pointer hover:underline" data-word="difficult">difficult</span> word</div>
              </div>
              
              <div class="p-3 bg-white border-l-4 border-gray-300 rounded-r cursor-pointer hover:bg-gray-50 transition-colors">
                <div class="flex justify-between">
                  <div class="zh-sentence">这是第三句中文台词</div>
                  <button class="text-gray-500 hover:text-primary text-xs"><i class="fa fa-volume-up"></i></button>
                </div>
                <div class="en-sentence text-gray-700 mt-1">This is the third English line</div>
              </div>
              
              <div class="p-3 bg-white border-l-4 border-gray-300 rounded-r cursor-pointer hover:bg-gray-50 transition-colors">
                <div class="flex justify-between">
                  <div class="zh-sentence">这是第四句中文台词，包含一个<span class="text-red-500 cursor-pointer hover:underline" data-word="pronunciation">发音</span>的单词</div>
                  <button class="text-gray-500 hover:text-primary text-xs"><i class="fa fa-volume-up"></i></button>
                </div>
                <div class="en-sentence text-gray-700 mt-1">This is the fourth English line with the word <span class="text-red-500 cursor-pointer hover:underline" data-word="pronunciation">pronunciation</span></div>
              </div>
            </div>
            
            <!-- 听写输入区 (默认隐藏) -->
            <div id="dictation-container" class="mt-4 hidden">
              <div class="bg-white p-3 rounded border border-gray-200 mb-3">
                <div class="text-gray-500 text-sm mb-2">请听写以下句子：</div>
                <div class="en-sentence font-medium">This is the second English line with a difficult word</div>
              </div>
              <textarea id="dictation-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all resize-none" rows="2" placeholder="在此输入您听到的句子..."></textarea>
              <div class="flex justify-end mt-2 gap-2">
                <button id="check-dictation" class="bg-primary hover:bg-primary/90 text-white px-4 py-1.5 rounded text-sm transition-colors">
                  检查答案
                </button>
              </div>
              <div id="dictation-result" class="mt-3 hidden">
                <div class="p-3 bg-green-50 border border-green-200 rounded-lg text-green-800 text-sm">
                  <div class="font-medium mb-1">听写结果：</div>
                  <p>正确率：85% 很棒！注意单词 "difficult" 的拼写。</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 右侧：单词本和功能区 -->
        <div class="lg:w-1/3 space-y-4">
          <!-- 单词查询 -->
          <div class="bg-gray-50 rounded-lg p-4 shadow-sm">
            <h3 class="text-lg font-semibold mb-3 flex items-center">
              <i class="fa fa-search text-primary mr-2"></i>
              单词查询
            </h3>
            <div class="flex gap-2">
              <input type="text" id="word-search" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all" placeholder="输入单词查询...">
              <button id="search-btn" class="bg-primary hover:bg-primary/90 text-white px-3 py-2 rounded-lg transition-colors">
                <i class="fa fa-search"></i>
              </button>
            </div>
            
            <!-- 单词详情 (默认隐藏) -->
            <div id="word-details" class="mt-4 hidden">
              <div class="flex justify-between items-start">
                <div>
                  <h4 id="word" class="text-xl font-bold">difficult</h4>
                  <div id="pronunciation" class="text-gray-600 italic">/ˈdɪfɪkəlt/</div>
                </div>
                <button id="add-to-vocab" class="text-primary hover:text-primary/80 transition-colors">
                  <i class="fa fa-bookmark-o"></i>
                </button>
              </div>
              
              <div class="mt-3">
                <div class="font-medium mb-1">释义：</div>
                <div id="definition" class="text-gray-700 text-sm">
                  <p>adj. 困难的；不易的；费力的</p>
                  <p class="mt-1">例：This is a difficult problem to solve.</p>
                  <p class="text-gray-600">这是一个难以解决的问题。</p>
                </div>
              </div>
              
              <div class="mt-3 flex gap-2">
                <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-2 py-1 rounded text-sm transition-colors">
                  <i class="fa fa-volume-up mr-1"></i> 发音
                </button>
                <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-2 py-1 rounded text-sm transition-colors">
                  <i class="fa fa-exchange mr-1"></i> 同义词
                </button>
              </div>
            </div>
          </div>
          
          <!-- 单词本 -->
          <div class="bg-gray-50 rounded-lg p-4 shadow-sm">
            <div class="flex justify-between items-center mb-3">
              <h3 class="text-lg font-semibold flex items-center">
                <i class="fa fa-book text-primary mr-2"></i>
                我的单词本
              </h3>
              <span class="text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full">5个单词</span>
            </div>
            
            <div id="vocabulary-list" class="max-h-64 overflow-y-auto scrollbar-hide space-y-2">
              <div class="p-2 bg-white rounded border border-gray-200 flex justify-between items-center">
                <div>
                  <div class="font-medium">difficult</div>
                  <div class="text-xs text-gray-500">adj. 困难的</div>
                </div>
                <div class="flex gap-1">
                  <button class="text-gray-400 hover:text-primary"><i class="fa fa-eye"></i></button>
                  <button class="text-gray-400 hover:text-red-500"><i class="fa fa-trash-o"></i></button>
                </div>
              </div>
              
              <div class="p-2 bg-white rounded border border-gray-200 flex justify-between items-center">
                <div>
                  <div class="font-medium">pronunciation</div>
                  <div class="text-xs text-gray-500">n. 发音</div>
                </div>
                <div class="flex gap-1">
                  <button class="text-gray-400 hover:text-primary"><i class="fa fa-eye"></i></button>
                  <button class="text-gray-400 hover:text-red-500"><i class="fa fa-trash-o"></i></button>
                </div>
              </div>
              
              <div class="p-2 bg-white rounded border border-gray-200 flex justify-between items-center">
                <div>
                  <div class="font-medium">abundant</div>
                  <div class="text-xs text-gray-500">adj. 丰富的</div>
                </div>
                <div class="flex gap-1">
                  <button class="text-gray-400 hover:text-primary"><i class="fa fa-eye"></i></button>
                  <button class="text-gray-400 hover:text-red-500"><i class="fa fa-trash-o"></i></button>
                </div>
              </div>
            </div>
            
            <button class="w-full mt-3 text-center text-primary hover:text-primary/80 text-sm transition-colors">
              查看全部单词 <i class="fa fa-angle-right ml-1"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 单词查询弹窗 (默认隐藏) -->
  <div id="word-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full max-h-[80vh] overflow-y-auto m-4 transform transition-all scale-95 opacity-0" id="modal-content">
      <div class="p-5 border-b border-gray-100">
        <div class="flex justify-between items-center">
          <h3 class="text-xl font-bold">单词详情</h3>
          <button id="close-modal" class="text-gray-400 hover:text-gray-600">
            <i class="fa fa-times"></i>
          </button>
        </div>
      </div>
      <div class="p-5">
        <!-- 内容与单词查询区相同，但更详细 -->
        <div class="flex justify-between items-start">
          <div>
            <h4 class="text-2xl font-bold">pronunciation</h4>
            <div class="text-gray-600 italic mt-1">/prəˌnʌnsiˈeɪʃn/</div>
            <button class="mt-2 text-primary hover:text-primary/80">
              <i class="fa fa-volume-up mr-1"></i> 播放发音
            </button>
          </div>
          <button class="bg-primary hover:bg-primary/90 text-white p-2 rounded-full transition-colors">
            <i class="fa fa-bookmark-o"></i>
          </button>
        </div>
        
        <div class="mt-4">
          <div class="font-semibold mb-2">词性：名词 (noun)</div>
          <div class="text-gray-700">
            <p class="mb-2">释义：发音；读音；发音方式</p>
            <div class="bg-gray-50 p-3 rounded-lg mt-3">
              <div class="font-medium mb-1">例句：</div>
              <p class="mb-2">"Her pronunciation of English is excellent."</p>
              <p class="text-gray-600">她的英语发音非常好。</p>
            </div>
          </div>
        </div>
        
        <div class="mt-4">
          <div class="font-semibold mb-2">同义词：</div>
          <div class="flex flex-wrap gap-2">
            <span class="bg-gray-100 px-2 py-1 rounded text-sm">articulation</span>
            <span class="bg-gray-100 px-2 py-1 rounded text-sm">enunciation</span>
          </div>
        </div>
        
        <div class="mt-4">
          <div class="font-semibold mb-2">派生词：</div>
          <div class="flex flex-wrap gap-2">
            <span class="bg-gray-100 px-2 py-1 rounded text-sm">pronounce (v.)</span>
            <span class="bg-gray-100 px-2 py-1 rounded text-sm">pronounced (adj.)</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // DOM元素
    const video = document.getElementById('main-video');
    const playPauseBtn = document.getElementById('play-pause');
    const progressContainer = document.getElementById('progress-container');
    const progressBar = document.getElementById('progress-bar');
    const currentTimeEl = document.getElementById('current-time');
    const totalTimeEl = document.getElementById('total-time');
    const muteBtn = document.getElementById('mute-toggle');
    const volumeSlider = document.getElementById('volume-slider');
    const fullscreenBtn = document.getElementById('fullscreen-toggle');
    const loopBtn = document.getElementById('loop-toggle');
    const speedOptions = document.querySelectorAll('.speed-option');
    const speedDisplay = document.getElementById('speed-display');
    const subtitleOptions = document.querySelectorAll('.subtitle-option');
    const subtitleDisplay = document.getElementById('subtitle-display');
    const zhSubtitle = document.getElementById('zh-subtitle');
    const enSubtitle = document.getElementById('en-subtitle');
    const prevSentenceBtn = document.getElementById('prev-sentence');
    const nextSentenceBtn = document.getElementById('next-sentence');
    const recordBtn = document.getElementById('record-btn');
    const stopRecordBtn = document.getElementById('stop-record-btn');
    const playRecordBtn = document.getElementById('play-record-btn');
    const compareBtn = document.getElementById('compare-btn');
    const scoreResult = document.getElementById('score-result');
    const recordingIndicator = document.getElementById('recording-indicator');
    const dictationModeBtn = document.getElementById('dictation-mode');
    const dictationContainer = document.getElementById('dictation-container');
    const checkDictationBtn = document.getElementById('check-dictation');
    const dictationResult = document.getElementById('dictation-result');
    const wordSearchInput = document.getElementById('word-search');
    const searchBtn = document.getElementById('search-btn');
    const wordDetails = document.getElementById('word-details');
    const addToVocabBtn = document.getElementById('add-to-vocab');
    const wordModal = document.getElementById('word-modal');
    const modalContent = document.getElementById('modal-content');
    const closeModalBtn = document.getElementById('close-modal');
    
    // 全局变量
    let isRecording = false;
    let mediaRecorder;
    let audioChunks = [];
    let recordedAudio;
    let isLooping = false;
    let currentSubtitleMode = 'zh';
    let isDictationMode = false;
    
    // 格式化时间
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    
    // 更新进度条
    function updateProgress() {
      const percent = (video.currentTime / video.duration) * 100;
      progressBar.style.width = `${percent}%`;
      currentTimeEl.textContent = formatTime(video.currentTime);
    }
    
    // 播放/暂停切换
    playPauseBtn.addEventListener('click', () => {
      if (video.paused) {
        video.play();
        playPauseBtn.innerHTML = '<i class="fa fa-pause text-xl"></i>';
      } else {
        video.pause();
        playPauseBtn.innerHTML = '<i class="fa fa-play text-xl"></i>';
      }
    });
    
    // 进度条控制
    progressContainer.addEventListener('click', (e) => {
      const progressWidth = progressContainer.clientWidth;
      const clickPosition = e.offsetX;
      const videoTime = (clickPosition / progressWidth) * video.duration;
      video.currentTime = videoTime;
    });
    
    // 静音控制
    muteBtn.addEventListener('click', () => {
      video.muted = !video.muted;
      muteBtn.innerHTML = video.muted ? 
        '<i class="fa fa-volume-off"></i>' : 
        '<i class="fa fa-volume-up"></i>';
    });
    
    // 音量控制
    volumeSlider.addEventListener('input', () => {
      video.volume = volumeSlider.value;
      // 更新音量图标
      if (video.volume === 0) {
        video.muted = true;
        muteBtn.innerHTML = '<i class="fa fa-volume-off"></i>';
      } else if (video.muted) {
        video.muted = false;
        muteBtn.innerHTML = '<i class="fa fa-volume-up"></i>';
      }
    });
    
    // 全屏控制
    fullscreenBtn.addEventListener('click', () => {
      const videoContainer = video.parentElement;
      if (!document.fullscreenElement) {
        videoContainer.requestFullscreen().catch(err => {
          console.error(`全屏错误: ${err.message}`);
        });
        fullscreenBtn.innerHTML = '<i class="fa fa-compress"></i>';
      } else {
        document.exitFullscreen();
        fullscreenBtn.innerHTML = '<i class="fa fa-expand"></i>';
      }
    });
    
    // 循环播放控制
    loopBtn.addEventListener('click', () => {
      isLooping = !isLooping;
      video.loop = isLooping;
      loopBtn.classList.toggle('text-primary', isLooping);
    });
    
    // 倍速控制
    speedOptions.forEach(option => {
      option.addEventListener('click', () => {
        const speed = parseFloat(option.dataset.speed);
        video.playbackRate = speed;
        speedDisplay.textContent = `${speed}x`;
        
        // 更新选中状态
        speedOptions.forEach(opt => {
          opt.classList.remove('bg-primary/20');
        });
        option.classList.add('bg-primary/20');
      });
    });
    
    // 字幕模式控制
    subtitleOptions.forEach(option => {
      option.addEventListener('click', () => {
        currentSubtitleMode = option.dataset.subtitle;
        updateSubtitleDisplay();
        
        // 更新选中状态
        subtitleOptions.forEach(opt => {
          opt.classList.remove('bg-primary/20');
        });
        option.classList.add('bg-primary/20');
        
        // 更新显示文本
        switch(currentSubtitleMode) {
          case 'zh':
            subtitleDisplay.textContent = '中';
            break;
          case 'en':
            subtitleDisplay.textContent = '英';
            break;
          case 'both':
            subtitleDisplay.textContent = '双';
            break;
          case 'off':
            subtitleDisplay.textContent = '关';
            break;
        }
      });
    });
    
    // 更新字幕显示
    function updateSubtitleDisplay() {
      switch(currentSubtitleMode) {
        case 'zh':
          zhSubtitle.classList.remove('hidden');
          enSubtitle.classList.add('hidden');
          break;
        case 'en':
          zhSubtitle.classList.add('hidden');
          enSubtitle.classList.remove('hidden');
          break;
        case 'both':
          zhSubtitle.classList.remove('hidden');
          enSubtitle.classList.remove('hidden');
          break;
        case 'off':
          zhSubtitle.classList.add('hidden');
          enSubtitle.classList.add('hidden');
          break;
      }
    }
    
    // 上一句/下一句控制
    prevSentenceBtn.addEventListener('click', () => {
      // 实际应用中应该跳转到上一句的时间点
      video.currentTime = Math.max(0, video.currentTime - 5);
    });
    
    nextSentenceBtn.addEventListener('click', () => {
      // 实际应用中应该跳转到下一句的时间点
      video.currentTime = Math.min(video.duration, video.currentTime + 5);
    });
    
    // 录音功能
    recordBtn.addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        
        mediaRecorder.addEventListener('dataavailable', (e) => {
          audioChunks.push(e.data);
        });
        
        mediaRecorder.addEventListener('stop', () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
          recordedAudio = URL.createObjectURL(audioBlob);
        });
        
        mediaRecorder.start();
        isRecording = true;
        
        // 更新UI
        recordBtn.classList.add('hidden');
        stopRecordBtn.classList.remove('hidden');
        recordingIndicator.classList.remove('hidden');
        video.pause();
        playPauseBtn.innerHTML = '<i class="fa fa-play text-xl"></i>';
      } catch (err) {
        console.error('录音权限被拒绝:', err);
        alert('无法访问麦克风，请确保已授予权限。');
      }
    });
    
    stopRecordBtn.addEventListener('click', () => {
      if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        
        // 更新UI
        stopRecordBtn.classList.add('hidden');
        playRecordBtn.classList.remove('hidden');
        compareBtn.classList.remove('hidden');
        recordingIndicator.classList.add('hidden');
      }
    });
    
    playRecordBtn.addEventListener('click', () => {
      if (recordedAudio) {
        const audio = new Audio(recordedAudio);
        audio.play();
      }
    });
    
    compareBtn.addEventListener('click', () => {
      // 模拟AI评分
      scoreResult.classList.remove('hidden');
      // 平滑滚动到评分结果
      scoreResult.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });
    
    // 听写模式切换
    dictationModeBtn.addEventListener('click', () => {
      isDictationMode = !isDictationMode;
      if (isDictationMode) {
        dictationContainer.classList.remove('hidden');
        dictationModeBtn.textContent = '退出听写';
        dictationModeBtn.classList.remove('bg-accent/10', 'text-accent');
        dictationModeBtn.classList.add('bg-red-100', 'text-red-600');
      } else {
        dictationContainer.classList.add('hidden');
        dictationModeBtn.textContent = '听写模式';
        dictationModeBtn.classList.remove('bg-red-100', 'text-red-600');
        dictationModeBtn.classList.add('bg-accent/10', 'text-accent');
        dictationResult.classList.add('hidden');
      }
    });
    
    // 检查听写结果
    checkDictationBtn.addEventListener('click', () => {
      dictationResult.classList.remove('hidden');
    });
    
    // 单词查询
    searchBtn.addEventListener('click', () => {
      const word = wordSearchInput.value.trim();
      if (word) {
        wordDetails.classList.remove('hidden');
        // 在实际应用中，这里应该调用词典API获取单词详情
      }
    });
    
    wordSearchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        searchBtn.click();
      }
    });
    
    // 添加到单词本
    addToVocabBtn.addEventListener('click', () => {
      addToVocabBtn.innerHTML = '<i class="fa fa-bookmark"></i>';
      // 实际应用中应该将单词添加到用户的单词本
    });
    
    // 点击生词显示详情
    document.querySelectorAll('[data-word]').forEach(wordEl => {
      wordEl.addEventListener('click', () => {
        const word = wordEl.dataset.word;
        // 在实际应用中，这里应该加载该单词的详情
        openWordModal();
      });
    });
    
    // 单词详情弹窗
    function openWordModal() {
      wordModal.classList.remove('hidden');
      setTimeout(() => {
        modalContent.classList.remove('scale-95', 'opacity-0');
        modalContent.classList.add('scale-100', 'opacity-100');
      }, 10);
    }
    
    function closeWordModal() {
      modalContent.classList.remove('scale-100', 'opacity-100');
      modalContent.classList.add('scale-95', 'opacity-0');
      setTimeout(() => {
        wordModal.classList.add('hidden');
      }, 300);
    }
    
    closeModalBtn.addEventListener('click', closeWordModal);
    
    wordModal.addEventListener('click', (e) => {
      if (e.target === wordModal) {
        closeWordModal();
      }
    });
    
    // 视频事件监听
    video.addEventListener('timeupdate', updateProgress);
    
    video.addEventListener('loadedmetadata', () => {
      totalTimeEl.textContent = formatTime(video.duration);
    });
    
    video.addEventListener('ended', () => {
      playPauseBtn.innerHTML = '<i class="fa fa-play text-xl"></i>';
    });
    
    // 初始化
    updateProgress();
  </script>
</body>
</html>